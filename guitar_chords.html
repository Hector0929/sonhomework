<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>吉他和弦查詢</title>
    <style>
        :root {
            --primary-bg: #f4f4f9;
            --secondary-bg: #ffffff;
            --text-color: #333;
            --accent-color: #007bff;
            --border-color: #ddd;
            --muted-color: #888;
            --root-note-color: #e74c3c;
        }
        body {
            font-family: -apple-system, BlinkMacSystemFont, "Segoe UI", Roboto, "Helvetica Neue", Arial, sans-serif;
            margin: 0;
            padding: 20px;
            background-color: var(--primary-bg);
            color: var(--text-color);
            display: flex;
            justify-content: center;
            align-items: flex-start;
            min-height: 100vh;
        }
        .container {
            width: 100%;
            max-width: 500px;
            background-color: var(--secondary-bg);
            border-radius: 10px;
            box-shadow: 0 4px 12px rgba(0,0,0,0.1);
            padding: 20px;
        }
        h1 {
            text-align: center;
            margin-top: 0;
            color: var(--accent-color);
        }
        .controls {
            display: flex;
            gap: 15px;
            margin-bottom: 25px;
        }
        .controls select {
            flex: 1;
            padding: 10px;
            font-size: 16px;
            border: 1px solid var(--border-color);
            border-radius: 5px;
            background-color: #fff;
        }
        .chord-display {
            text-align: center;
        }
        #chord-name {
            font-size: 2.5em;
            font-weight: bold;
            margin-bottom: 20px;
        }
        .diagram-container {
            display: flex;
            justify-content: center;
            align-items: flex-start;
            gap: 20px;
        }
        #chord-diagram {
            width: 180px;
            height: 220px;
        }
        .info-panel {
            text-align: left;
            padding-top: 20px;
        }
        .info-panel h3 {
            margin-top: 0;
            border-bottom: 2px solid var(--border-color);
            padding-bottom: 5px;
        }
        #constituent-notes ul {
            list-style: none;
            padding: 0;
            margin: 0;
        }
        #constituent-notes li {
            font-size: 1.1em;
            margin-bottom: 8px;
        }
        #constituent-notes .interval {
            color: var(--muted-color);
            font-size: 0.9em;
            margin-left: 8px;
        }

        /* 響應式設計 */
        @media (max-width: 480px) {
            body {
                padding: 10px;
            }
            .container {
                padding: 15px;
            }
            .controls {
                flex-direction: column;
            }
            .diagram-container {
                flex-direction: column;
                align-items: center;
            }
            #chord-diagram {
                width: 200px;
                height: 240px;
                margin-bottom: 20px;
            }
            .info-panel {
                width: 100%;
                text-align: center;
            }
             .info-panel h3 {
                text-align: left;
            }
        }
    </style>
</head>
<body>

    <div class="container">
        <h1>吉他和弦查詢</h1>
        <div class="controls">
            <select id="root-note-select">
                <option value="C">C</option>
                <option value="C#">C# / Db</option>
                <option value="D">D</option>
                <option value="D#">D# / Eb</option>
                <option value="E">E</option>
                <option value="F">F</option>
                <option value="F#">F# / Gb</option>
                <option value="G">G</option>
                <option value="G#">G# / Ab</option>
                <option value="A">A</option>
                <option value="A#">A# / Bb</option>
                <option value="B">B</option>
            </select>
            <select id="chord-type-select">
                <option value="major">Major</option>
                <option value="minor">minor</option>
                <option value="7">7</option>
                <option value="maj7">maj7</option>
                <option value="m7">m7</option>
            </select>
        </div>

        <div class="chord-display">
            <div id="chord-name">C Major</div>
            <div class="diagram-container">
                <svg id="chord-diagram"></svg>
                <div class="info-panel">
                    <div id="constituent-notes">
                        <h3>組成音</h3>
                        <ul></ul>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // --- 和弦資料庫 (Chord Database) ---
        // 根據 PRD 建議，MVP 階段先使用靜態資料庫
        // -1: 啞音 (Muted), 0: 空弦 (Open)
        // positions: [第6弦, 第5弦, 第4弦, 第3弦, 第2弦, 第1弦]
        // fingers: 對應的指法 (0 代表不按)
        // baseFret: 和弦圖開始的琴格
        // root: 標示根音在哪幾條弦上 (從6到1)
        const chordData = {
            'C_major': {
                positions: [-1, 3, 2, 0, 1, 0],
                fingers: [0, 3, 2, 0, 1, 0],
                baseFret: 1,
                root: [5],
                notes: [
                    { note: 'C', interval: '根音' },
                    { note: 'E', interval: '大三度' },
                    { note: 'G', interval: '完全五度' }
                ]
            },
            'A_minor': {
                positions: [-1, 0, 2, 2, 1, 0],
                fingers: [0, 0, 2, 3, 1, 0],
                baseFret: 1,
                root: [5],
                notes: [
                    { note: 'A', interval: '根音' },
                    { note: 'C', interval: '小三度' },
                    { note: 'E', interval: '完全五度' }
                ]
            },
            'G_major': {
                positions: [3, 2, 0, 0, 0, 3],
                fingers: [2, 1, 0, 0, 0, 3],
                baseFret: 1,
                root: [6, 1],
                notes: [
                    { note: 'G', interval: '根音' },
                    { note: 'B', interval: '大三度' },
                    { note: 'D', interval: '完全五度' }
                ]
            },
            'E_major': {
                positions: [0, 2, 2, 1, 0, 0],
                fingers: [0, 2, 3, 1, 0, 0],
                baseFret: 1,
                root: [6, 4, 1],
                notes: [
                    { note: 'E', interval: '根音' },
                    { note: 'G#', interval: '大三度' },
                    { note: 'B', interval: '完全五度' }
                ]
            },
            'F_major': { // 封閉和弦範例
                positions: [1, 3, 3, 2, 1, 1],
                fingers: [1, 3, 4, 2, 1, 1],
                baseFret: 1,
                root: [6, 1],
                notes: [
                    { note: 'F', interval: '根音' },
                    { note: 'A', interval: '大三度' },
                    { note: 'C', interval: '完全五度' }
                ]
            },
            // 為了展示，我們只先建立幾個和弦
            // 之後可以擴充這個資料庫
        };

        // --- DOM 元素 ---
        const rootNoteSelect = document.getElementById('root-note-select');
        const chordTypeSelect = document.getElementById('chord-type-select');
        const chordNameEl = document.getElementById('chord-name');
        const svgEl = document.getElementById('chord-diagram');
        const notesListEl = document.querySelector('#constituent-notes ul');

        // --- 繪圖常數 ---
        const FRET_COUNT = 5;
        const STRING_COUNT = 6;

        function drawChordDiagram(data) {
            if (!data) {
                svgEl.innerHTML = `<text x="50%" y="50%" text-anchor="middle" fill="var(--muted-color)">暫無資料</text>`;
                return;
            }

            svgEl.innerHTML = ''; // 清空舊圖

            const viewWidth = svgEl.clientWidth;
            const viewHeight = svgEl.clientHeight;
            
            const PADDING = { top: 40, right: 10, bottom: 10, left: 30 };
            const chartWidth = viewWidth - PADDING.left - PADDING.right;
            const chartHeight = viewHeight - PADDING.top - PADDING.bottom;

            const stringSpacing = chartWidth / (STRING_COUNT - 1);
            const fretSpacing = chartHeight / FRET_COUNT;

            // 繪製琴格編號
            if (data.baseFret > 1) {
                const fretNumber = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                fretNumber.setAttribute('x', PADDING.left - 15);
                fretNumber.setAttribute('y', PADDING.top + fretSpacing * 0.5);
                fretNumber.setAttribute('font-size', '14');
                fretNumber.setAttribute('fill', 'var(--text-color)');
                fretNumber.textContent = `${data.baseFret}fr`;
                svgEl.appendChild(fretNumber);
            }

            // 繪製琴弦 (垂直線)
            for (let i = 0; i < STRING_COUNT; i++) {
                const x = PADDING.left + i * stringSpacing;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', x);
                line.setAttribute('y1', PADDING.top);
                line.setAttribute('x2', x);
                line.setAttribute('y2', PADDING.top + chartHeight);
                line.setAttribute('stroke', 'var(--border-color)');
                line.setAttribute('stroke-width', '1');
                svgEl.appendChild(line);
            }

            // 繪製琴衍 (水平線)
            for (let i = 0; i <= FRET_COUNT; i++) {
                const y = PADDING.top + i * fretSpacing;
                const line = document.createElementNS('http://www.w3.org/2000/svg', 'line');
                line.setAttribute('x1', PADDING.left);
                line.setAttribute('y1', y);
                line.setAttribute('x2', PADDING.left + chartWidth);
                line.setAttribute('y2', y);
                line.setAttribute('stroke', 'var(--text-color)');
                // 上方弦枕加粗
                line.setAttribute('stroke-width', i === 0 ? '4' : '1');
                svgEl.appendChild(line);
            }

            // 繪製按法標示
            for (let i = 0; i < STRING_COUNT; i++) {
                const stringIndex = i; // 0-5
                const stringNum = STRING_COUNT - i; // 6-1
                const fret = data.positions[stringIndex];
                const finger = data.fingers[stringIndex];
                const x = PADDING.left + i * stringSpacing;

                if (fret === -1) { // 啞音 X
                    const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                    text.setAttribute('x', x);
                    text.setAttribute('y', PADDING.top - 10);
                    text.setAttribute('text-anchor', 'middle');
                    text.setAttribute('font-size', '16');
                    text.setAttribute('font-weight', 'bold');
                    text.setAttribute('fill', 'var(--muted-color)');
                    text.textContent = 'X';
                    svgEl.appendChild(text);
                } else if (fret === 0) { // 空弦 O
                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', PADDING.top - 12);
                    circle.setAttribute('r', 6);
                    circle.setAttribute('stroke', 'var(--text-color)');
                    circle.setAttribute('stroke-width', '1.5');
                    circle.setAttribute('fill', 'none');
                    svgEl.appendChild(circle);
                } else { // 按壓點
                    const y = PADDING.top + (fret - data.baseFret + 0.5) * fretSpacing;
                    
                    // 處理封閉和弦橫槓
                    if (finger === 1 && data.positions.filter(p => p === fret).length > 1 && i === data.positions.indexOf(fret)) {
                        const first = data.positions.indexOf(fret);
                        const last = data.positions.lastIndexOf(fret);
                        const barX1 = PADDING.left + first * stringSpacing;
                        const barX2 = PADDING.left + last * stringSpacing;
                        const rect = document.createElementNS('http://www.w3.org/2000/svg', 'rect');
                        rect.setAttribute('x', barX1 - 6);
                        rect.setAttribute('y', y - 6);
                        rect.setAttribute('width', barX2 - barX1 + 12);
                        rect.setAttribute('height', 12);
                        rect.setAttribute('rx', 6);
                        rect.setAttribute('ry', 6);
                        rect.setAttribute('fill', 'var(--text-color)');
                        svgEl.appendChild(rect);
                    }

                    const circle = document.createElementNS('http://www.w3.org/2000/svg', 'circle');
                    circle.setAttribute('cx', x);
                    circle.setAttribute('cy', y);
                    circle.setAttribute('r', 8);
                    
                    // 高亮根音
                    const isRoot = data.root.includes(stringNum);
                    circle.setAttribute('fill', isRoot ? 'var(--root-note-color)' : 'var(--text-color)');
                    svgEl.appendChild(circle);

                    // 指法數字
                    if (finger > 0) {
                        const text = document.createElementNS('http://www.w3.org/2000/svg', 'text');
                        text.setAttribute('x', x);
                        text.setAttribute('y', y + 5);
                        text.setAttribute('text-anchor', 'middle');
                        text.setAttribute('font-size', '14');
                        text.setAttribute('fill', '#fff');
                        text.textContent = finger;
                        svgEl.appendChild(text);
                    }
                }
            }
        }

        function updateDisplay() {
            const rootNote = rootNoteSelect.value;
            const chordType = chordTypeSelect.value;
            
            // 格式化顯示名稱
            let typeText = chordType.replace('major', '').replace('minor', 'm');
            chordNameEl.textContent = `${rootNote.replace('#', '♯')} ${typeText}`;

            // 尋找和弦資料
            const chordKey = `${rootNote}_${chordType}`;
            const data = chordData[chordKey];

            // 更新和弦圖
            drawChordDiagram(data);

            // 更新組成音
            notesListEl.innerHTML = '';
            if (data && data.notes) {
                data.notes.forEach(item => {
                    const li = document.createElement('li');
                    li.innerHTML = `${item.note.replace('#', '♯')} <span class="interval">(${item.interval})</span>`;
                    notesListEl.appendChild(li);
                });
            } else {
                const li = document.createElement('li');
                li.textContent = '暫無資料';
                notesListEl.appendChild(li);
            }
        }

        // --- 事件監聽 ---
        rootNoteSelect.addEventListener('change', updateDisplay);
        chordTypeSelect.addEventListener('change', updateDisplay);

        // --- 初始載入 ---
        // 為了讓 A minor 預設被選中
        rootNoteSelect.value = 'A';
        chordTypeSelect.value = 'minor';
        updateDisplay();
    </script>
</body>
</html>