<!DOCTYPE html>
<html lang="zh-TW">
<head>
  <meta charset="UTF-8" />
  <title>辨識結果｜Chord Pages</title>
  <style>
    body { font-family: system-ui, -apple-system, Segoe UI, Roboto, "Noto Sans TC", Arial, sans-serif; background:#f8fafc; }
    .upload-card { max-width:980px; margin:18px auto; padding:20px; border:2px dashed #e2e8f0; border-radius:14px; background:#fff; }
    .preview-stage { margin-top: 8px; border: 2px dashed #e2e8f0; border-radius: 12px; background: #fff; padding: 12px; min-height: 260px; overflow: auto; }
    .overlay-stage { position: relative; display: inline-block; transform-origin: top left; }
    .overlay-stage > img { display: block; max-width: 100%; height: auto; }
    .tag { position: absolute; box-sizing: border-box; border-radius: 4px; padding: 0 4px; line-height: 1; display: flex; align-items: center; justify-content: center; font-family: monospace; }
    .tag.chord { background: rgba(0,0,0,.88); color: #ffd700; font-weight: 700; }
    .tag.lyric { background: rgba(255,255,255,.75); color: #111; border: 1px solid #e5e7eb; }
    .row { display:flex; gap:8px; align-items:center; margin-top:8px; }
    .btn { padding:8px 12px; border-radius:8px; border:1px solid #e5e7eb; background:#f8fafc; cursor:pointer; }
    .btn.primary { background:#2563eb; color:#fff; border:none; }
  </style>
  <script src="../assets/chords_shared.js"></script>
</head>
<body>
  <div class="upload-card">
    <h2 style="margin:0;">辨識結果</h2>
    <div id="recognition-result" class="preview-stage"></div>
    <div class="row">
      <button id="to-transpose" class="btn primary">下一步：移調</button>
    </div>
  </div>
  <script>
    const state = App.loadAppState();
    if(!state?.rawURL){ location.replace('scan.html'); }

    const container = document.getElementById('recognition-result');
    // 注意：這裡沿用已有 tokens（若為空則僅顯示底圖）
    Chords.renderStage(container, state.preURL || state.rawURL, state.tokens || []);

    document.getElementById('to-transpose').addEventListener('click', ()=>{
      // 保留 tokens 與圖像於 AppState，直接前往移調頁
      location.href = 'transpose.html';
    });
  </script>
</body>
</html>