<!DOCTYPE html>
<html lang="zh-TW">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ä¹ä¹ä¹˜æ³•æ‰“æ“Šæ•µæ©ŸéŠæˆ² V9 (Firebase æ•´åˆç‰ˆ)</title>
    <!-- Tailwind CSS CDN -->
    <script src="https://cdn.tailwindcss.com"></script>
    <style>
        /* è‡ªå®šç¾©å­—é«” */
        body {
            font-family: "Inter", sans-serif;
        }
        /* ç¢ºä¿ canvas ä½”ç”¨å…¶çˆ¶å®¹å™¨çš„å¯ç”¨ç©ºé–“ */
        canvas {
            display: block;
            background-color: #a7f3d0; /* æ·ºç¶ è‰²èƒŒæ™¯ */
            border-bottom: 2px solid #9ca3af; /* ç°è‰²é‚Šæ¡† */
            border-radius: 0.5rem; /* åœ“è§’ */
            width: 100%; /* ä½”æ»¿çˆ¶å®¹å™¨å¯¬åº¦ */
            height: calc(50vh); /* å°‡é«˜åº¦è¨­å®šç‚ºè¦–å£é«˜åº¦çš„ä¸€åŠ */
        }
        /* å½ˆå‡ºè¦–çª—çš„åŸºåº•æ¨£å¼ */
        .modal-screen {
            position: fixed; /* æ”¹ç‚º fixed ä»¥è¦†è“‹æ•´å€‹è¦–çª— */
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background-color: rgba(0, 0, 0, 0.8);
            color: white;
            display: flex;
            flex-direction: column;
            justify-content: center;
            align-items: center;
            font-size: 2rem;
            font-weight: bold;
            text-align: center;
            z-index: 100;
            padding: 1rem;
        }
        /* éŠæˆ²å®¹å™¨çš„åŸºåº•æ¨£å¼ï¼Œç¢ºä¿åœ¨éœ€è¦æ™‚å¯ä»¥é¡¯ç¤º */
        #game-area {
            display: none; /* é è¨­éš±è—ï¼Œç”± JS æ§åˆ¶é¡¯ç¤º */
            flex-direction: column; /* ç¢ºä¿å…§å®¹å‚ç›´æ’åˆ— */
        }
    </style>
</head>
<body class="flex flex-col items-center justify-center min-h-screen bg-gray-100 p-4 relative">
    <!-- åç¨±è¼¸å…¥ç•«é¢ -->
    <div id="nameInputScreen" class="modal-screen flex">
        <div class="bg-white p-8 rounded-lg shadow-xl text-black w-full max-w-sm">
            <h2 class="text-3xl font-bold mb-4">è¼¸å…¥ä½ çš„ç©å®¶åç¨±</h2>
            <input type="text" id="playerNameInput" class="w-full px-4 py-2 border rounded-lg text-xl" placeholder="ç©å®¶åç¨±" maxlength="10">
            <button id="submitNameButton" class="mt-4 w-full px-6 py-3 bg-green-600 text-white text-xl font-bold rounded-lg shadow-md hover:bg-green-700">
                ç¢ºèª
            </button>
        </div>
    </div>

    <!-- æ’è¡Œæ¦œç•«é¢ -->
    <div id="leaderboardScreen" class="modal-screen hidden">
           <div class="bg-gray-800 p-8 rounded-lg shadow-xl w-full max-w-md">
                <h2 class="text-4xl font-bold mb-6 text-yellow-400">ğŸ† ç·šä¸Šæ’è¡Œæ¦œ ğŸ†</h2>
                <ol id="leaderboardList" class="text-left text-2xl space-y-2">
                    <!-- æ’è¡Œæ¦œé …ç›®å°‡ç”± JS ç”Ÿæˆ -->
                </ol>
                <button id="closeLeaderboardButton" class="mt-8 px-6 py-3 bg-red-600 text-white text-xl font-bold rounded-lg shadow-md hover:bg-red-700">
                    é—œé–‰
                </button>
            </div>
    </div>

    <!-- ä¸»éŠæˆ²å€åŸŸ -->
    <div id="game-area" class="w-full max-w-3xl bg-white rounded-lg shadow-lg overflow-hidden">
        <!-- éŠæˆ²ç•«å¸ƒå€åŸŸ -->
        <canvas id="gameCanvas"></canvas>

        <!-- éŠæˆ²æ§åˆ¶å’Œè³‡è¨Šå€åŸŸ -->
        <div class="p-4 bg-gray-50 flex flex-col items-center justify-center text-center rounded-b-lg">
            <div class="text-2xl font-semibold mb-2 flex justify-between items-center w-full px-4">
                <span id="scoreDisplay">åˆ†æ•¸: 0</span>
                <button id="viewLeaderboardButton" class="px-4 py-2 bg-yellow-500 text-white text-base font-bold rounded-lg shadow-md hover:bg-yellow-600">
                    æ’è¡Œæ¦œ
                </button>
            </div>
            <div class="text-4xl font-bold mb-4 text-center w-full">
                <span id="questionDisplay">é»æ“Šé–‹å§‹éŠæˆ²</span>
            </div>
            <div id="answerOptionsContainer" class="grid grid-cols-2 gap-4 mb-4 w-full max-w-sm"></div>
            <div class="h-2 bg-gray-300 rounded-full mt-4 overflow-hidden w-full max-w-xs">
                <div id="questionTimerBar" class="h-full bg-green-500 transition-all duration-100 ease-linear" style="width: 100%;"></div>
            </div>
            <div id="feedbackDisplay" class="mt-2 text-red-600 font-semibold h-6"></div>
            <button id="startGameButton" class="mt-4 px-6 py-3 bg-blue-600 text-white text-xl font-bold rounded-lg shadow-md hover:bg-blue-700">
                é–‹å§‹éŠæˆ²
            </button>
        </div>
    </div>
    
    <!-- è¿”å›é¦–é æŒ‰éˆ• -->
    <button id="homeButton" class="mt-6 px-8 py-4 bg-gray-600 text-white text-xl font-bold rounded-lg shadow-md hover:bg-gray-700">
        è¿”å›é¦–é 
    </button>

    <!-- Firebase è…³æœ¬ -->
    <script type="module">
        import { initializeApp } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";
        import { getAuth, signInAnonymously } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";
        import { getFirestore, collection, addDoc, onSnapshot, query } from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";

        // DOM å…ƒç´ 
        const nameInputScreen = document.getElementById('nameInputScreen');
        const playerNameInput = document.getElementById('playerNameInput');
        const submitNameButton = document.getElementById('submitNameButton');
        const leaderboardScreen = document.getElementById('leaderboardScreen');
        const leaderboardList = document.getElementById('leaderboardList');
        const closeLeaderboardButton = document.getElementById('closeLeaderboardButton');
        const viewLeaderboardButton = document.getElementById('viewLeaderboardButton');
        const gameArea = document.getElementById('game-area');
        const canvas = document.getElementById('gameCanvas');
        const ctx = canvas.getContext('2d');
        const scoreDisplay = document.getElementById('scoreDisplay');
        const questionDisplay = document.getElementById('questionDisplay');
        const answerOptionsContainer = document.getElementById('answerOptionsContainer');
        const questionTimerBar = document.getElementById('questionTimerBar');
        const feedbackDisplay = document.getElementById('feedbackDisplay');
        const startGameButton = document.getElementById('startGameButton');
        const homeButton = document.getElementById('homeButton');
        
        // Firebase åˆå§‹åŒ–
        let db;
        let leaderboardCol;
        try {
            // *** ä½¿ç”¨æ‚¨è‡ªå·±çš„ Firebase è¨­å®šæª” ***
            const firebaseConfig = {
              apiKey: "AIzaSyCBhUzLaW5gvEgx2WsaL_jQvYLUDNi8qew",
              authDomain: "shootinggame-c7634.firebaseapp.com",
              projectId: "shootinggame-c7634",
              storageBucket: "shootinggame-c7634.firebasestorage.app", // å·²æ›´æ–°
              messagingSenderId: "942695280947",
              appId: "1:942695280947:web:6588adab2c5ad0a0478e46",
              measurementId: "G-99Z8KE9J6F"
            };
            
            const app = initializeApp(firebaseConfig);
            db = getFirestore(app);
            const auth = getAuth(app);

            // åœ¨å…¬é–‹ç¶²ç«™ä¸Šï¼Œæˆ‘å€‘ä½¿ç”¨åŒ¿åç™»å…¥
            signInAnonymously(auth).then(() => {
                console.log("Firebase å·²åŒ¿åèªè­‰ã€‚");
                // *** ä½¿ç”¨ç°¡åŒ–çš„è³‡æ–™åº«è·¯å¾‘ ***
                leaderboardCol = collection(db, 'leaderboard');
                listenToLeaderboard();
            }).catch(e => {
                console.error("Firebase åŒ¿åèªè­‰å¤±æ•—:", e);
                alert("ç„¡æ³•é€£æ¥åˆ° Firebase èªè­‰æœå‹™ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚");
            });

        } catch (e) {
            console.error("Firebase åˆå§‹åŒ–å¤±æ•—:", e);
            alert("ç„¡æ³•é€£æ¥åˆ°æ’è¡Œæ¦œä¼ºæœå™¨ï¼Œè«‹æª¢æŸ¥æ‚¨çš„ç¶²è·¯é€£ç·šæˆ–ç¨å¾Œå†è©¦ã€‚");
        }

        // åœ–ç‰‡è¼‰å…¥é‚è¼¯
        const playerImage = new Image();
        let isImageLoaded = false;
        startGameButton.disabled = true;
        startGameButton.textContent = 'åœ–ç‰‡è¼‰å…¥ä¸­...';
        playerImage.onload = () => {
            isImageLoaded = true;
            startGameButton.disabled = false;
            startGameButton.textContent = 'é–‹å§‹éŠæˆ²';
            console.log('ç©å®¶åœ–ç‰‡å·²è¼‰å…¥ï¼');
            resizeCanvas();
        };
        playerImage.onerror = () => {
            console.error('ç„¡æ³•è¼‰å…¥ç©å®¶åœ–ç‰‡ã€‚');
            startGameButton.textContent = 'åœ–ç‰‡è¼‰å…¥å¤±æ•—';
            startGameButton.classList.add('bg-red-500', 'cursor-not-allowed');
            feedbackDisplay.textContent = 'ç„¡æ³•è¼‰å…¥ç©å®¶åœ–ç‰‡ï¼';
        };
        playerImage.src = 'https://placehold.co/64x64/800080/FFFFFF?text=P';

        // éŠæˆ²ç‹€æ…‹è®Šæ•¸
        let currentPlayerName = '';
        let score = 0;
        let questionTimer = 5;
        let currentQuestion = { num1: 0, num2: 0, answer: 0 };
        let gameStarted = false;
        let gameOver = false;
        let player = null;
        let enemies = [];
        let bullets = [];
        let askedQuestions = new Set();
        let lastFrameTime = 0;
        let questionStartTime = 0;
        let gameLoopId = null;
        let questionTimerIntervalId = null;
        let enemySpawnTimer = 0;
        let speedIncreaseIntervalId = null;
        const maxEnemies = 10;
        
        // éŠæˆ²é›£åº¦è®Šæ•¸
        let enemySpeed = 0.5;
        const initialEnemySpawnInterval = 3000;
        let enemySpawnInterval = initialEnemySpawnInterval;

        // æ’è¡Œæ¦œç›¸é—œå‡½æ•¸
        async function saveToLeaderboard(name, score) {
            if (!leaderboardCol) return;
            try {
                await addDoc(leaderboardCol, { name, score, createdAt: new Date() }); // ä½¿ç”¨ Date() è€Œé serverTimestamp()
                console.log("åˆ†æ•¸å·²å„²å­˜è‡³ç·šä¸Šæ’è¡Œæ¦œï¼");
            } catch (e) {
                console.error("å„²å­˜åˆ†æ•¸å¤±æ•—:", e);
                feedbackDisplay.textContent = "ç„¡æ³•å„²å­˜åˆ†æ•¸ï¼";
            }
        }

        function listenToLeaderboard() {
            if (!leaderboardCol) return;
            // ç§»é™¤ orderBy å’Œ limitï¼Œæ”¹ç‚ºå®¢æˆ¶ç«¯æ’åºå’Œé™åˆ¶
            const q = query(leaderboardCol);
            onSnapshot(q, (snapshot) => {
                let leaderboard = [];
                snapshot.forEach((doc) => { leaderboard.push(doc.data()); });

                // å®¢æˆ¶ç«¯æ’åºï¼šåˆ†æ•¸é™åºï¼Œç„¶å¾Œå»ºç«‹æ™‚é–“é™åº
                leaderboard.sort((a, b) => {
                    if (a.score !== b.score) {
                        return b.score - a.score; // åˆ†æ•¸é«˜çš„åœ¨å‰
                    }
                    // å¦‚æœåˆ†æ•¸ç›¸åŒï¼Œå‰‡æ¯”è¼ƒå»ºç«‹æ™‚é–“ï¼ˆæ–°çš„åœ¨å‰ï¼‰
                    const dateA = a.createdAt instanceof Date ? a.createdAt.getTime() : (a.createdAt ? a.createdAt.toDate().getTime() : 0);
                    const dateB = b.createdAt instanceof Date ? b.createdAt.getTime() : (b.createdAt ? b.createdAt.toDate().getTime() : 0);
                    return dateB - dateA;
                });

                updateLeaderboardUI(leaderboard.slice(0, 10)); // åªå–å‰10å
            }, (error) => {
                console.error("è®€å–æ’è¡Œæ¦œå¤±æ•—:", error);
                leaderboardList.innerHTML = '<li class="text-red-400">ç„¡æ³•è¼‰å…¥æ’è¡Œæ¦œ...</li>';
            });
        }

        function updateLeaderboardUI(leaderboard) {
            leaderboardList.innerHTML = '';
            if (leaderboard.length === 0) {
                leaderboardList.innerHTML = '<li class="text-gray-400">ç›®å‰æ²’æœ‰ä»»ä½•ç´€éŒ„...</li>';
            } else {
                leaderboard.forEach((entry, index) => {
                    const li = document.createElement('li');
                    li.className = 'flex justify-between p-2 rounded';
                    let medal = ['ğŸ¥‡', 'ğŸ¥ˆ', 'ğŸ¥‰'][index] || '';
                    li.innerHTML = `
                        <span class="font-bold w-1/3">${medal} ${index + 1}. ${entry.name}</span>
                        <span class="text-yellow-300 w-2/3 text-right">${entry.score} åˆ†</span>
                    `;
                    if (index < 3) li.classList.add('bg-yellow-500', 'bg-opacity-20');
                    leaderboardList.appendChild(li);
                });
            }
        }

        function displayLeaderboard() {
            leaderboardScreen.classList.remove('hidden');
            leaderboardScreen.classList.add('flex');
        }

        // éŠæˆ²ç‰©ä»¶é¡åˆ¥
        class Bullet {
            constructor(startX, startY, targetEnemy) { this.x = startX; this.y = startY; this.target = targetEnemy; this.speed = 15; this.isDone = false; }
            update() { const targetX = this.target.x + this.target.width / 2; const targetY = this.target.y + this.target.height / 2; const dx = targetX - this.x; const dy = targetY - this.y; const distance = Math.sqrt(dx * dx + dy * dy); if (distance < this.speed) { this.isDone = true; this.target.isHit = true; score += 10; scoreDisplay.textContent = `åˆ†æ•¸: ${score}`; feedbackDisplay.textContent = 'æ®²æ»… 1 éš»æ•µè»ï¼'; } else { this.x += (dx / distance) * this.speed; this.y += (dy / distance) * this.speed; } }
            draw(ctx) { ctx.fillStyle = 'yellow'; ctx.beginPath(); ctx.arc(this.x, this.y, 5, 0, Math.PI * 2); ctx.fill(); }
        }
        class Player {
            constructor(x, y, width, height) { this.x = x; this.y = y; this.width = width; this.height = height; this.image = playerImage; }
            draw(ctx) { if (isImageLoaded && this.image.complete && this.image.naturalWidth !== 0) { ctx.drawImage(this.image, this.x, this.y, this.width, this.height); } else { ctx.fillStyle = 'purple'; ctx.fillRect(this.x, this.y, this.width, this.height); } }
        }
        class Enemy {
            constructor(x, y, width, height, color = 'red') { this.x = x; this.y = y; this.width = width; this.height = height; this.color = color; this.isHit = false; }
            draw(ctx) { if (this.isHit) return; ctx.fillStyle = this.color; ctx.fillRect(this.x, this.y, this.width, this.height); ctx.strokeStyle = 'black'; ctx.lineWidth = 2; ctx.beginPath(); ctx.moveTo(this.x, this.y); ctx.lineTo(this.x + this.width, this.y + this.height); ctx.moveTo(this.x + this.width, this.y); ctx.lineTo(this.x, this.y + this.height); ctx.stroke(); }
            update() { this.y += enemySpeed; }
        }

        // éŠæˆ²æ ¸å¿ƒé‚è¼¯
        function generateQuestion() {
            let num1, num2, questionString;
            do {
                num1 = Math.floor(Math.random() * 9) + 1;
                num2 = Math.floor(Math.random() * 9) + 1;
                questionString = `${Math.min(num1, num2)}x${Math.max(num1, num2)}`;
            } while (askedQuestions.has(questionString) && askedQuestions.size < 81);
            if (askedQuestions.size === 81) {
                askedQuestions.clear();
            }
            askedQuestions.add(questionString);
            currentQuestion = { num1, num2, answer: num1 * num2 };
            questionDisplay.textContent = `${currentQuestion.num1} x ${currentQuestion.num2} = ?`;
            feedbackDisplay.textContent = '';
            questionStartTime = Date.now();
            resetQuestionTimer();
            const answers = [currentQuestion.answer];
            while (answers.length < 4) {
                let wrongAnswer;
                do {
                    wrongAnswer = Math.floor(Math.random() * 81) + 1;
                } while (answers.includes(wrongAnswer) || Math.abs(wrongAnswer - currentQuestion.answer) < 3);
                answers.push(wrongAnswer);
            }
            for (let i = answers.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [answers[i], answers[j]] = [answers[j], answers[i]];
            }
            answerOptionsContainer.innerHTML = '';
            answers.forEach(ans => {
                const button = document.createElement('button');
                button.textContent = ans;
                button.classList.add(
                    'px-6', 'py-3', 'text-2xl',
                    'bg-blue-600', 'text-white', 'rounded-lg', 'shadow-md',
                    'hover:bg-blue-700', 'focus:outline-none', 'focus:ring-2', 'focus:ring-blue-500'
                );
                button.dataset.answer = ans;
                button.addEventListener('click', handleAnswerClick);
                answerOptionsContainer.appendChild(button);
            });
            enableAnswerButtons();
        }

        function enableAnswerButtons() {
            Array.from(answerOptionsContainer.children).forEach(button => {
                button.disabled = false;
                button.classList.add('bg-blue-600', 'hover:bg-blue-700');
                button.classList.remove('bg-gray-400', 'cursor-not-allowed');
            });
        }

        function disableAnswerButtons() {
            Array.from(answerOptionsContainer.children).forEach(button => {
                button.disabled = true;
                button.classList.remove('bg-blue-600', 'hover:bg-blue-700');
                button.classList.add('bg-gray-400', 'cursor-not-allowed');
            });
        }
        function resetQuestionTimer() { questionTimer = 5; questionTimerBar.style.width = '100%'; if (questionTimerIntervalId) { clearInterval(questionTimerIntervalId); } questionTimerIntervalId = setInterval(() => { questionTimer -= 0.05; if (questionTimer <= 0.05) { clearInterval(questionTimerIntervalId); if (gameStarted && !gameOver) { endGame("æ™‚é–“åˆ°ï¼Œä½ è¢«æ•µè»æ‰“æ•—äº†ï¼"); } questionTimer = 0; } questionTimerBar.style.width = `${(questionTimer / 5) * 100}%`; }, 50); }
        function handleAnswerClick(event) { if (!gameStarted || gameOver) return; const selectedAnswer = parseInt(event.target.dataset.answer, 10); disableAnswerButtons(); if (selectedAnswer === currentQuestion.answer) { const availableEnemies = enemies.filter(e => !e.isHit && !bullets.some(b => b.target === e)); if (availableEnemies.length > 0) { const targetEnemy = availableEnemies.sort((a, b) => b.y - a.y)[0]; const bulletStartX = player.x + player.width / 2; const bulletStartY = player.y; bullets.push(new Bullet(bulletStartX, bulletStartY, targetEnemy)); } generateQuestion(); } else { feedbackDisplay.textContent = 'ç­”éŒ¯äº†ï¼å†è©¦ä¸€æ¬¡ã€‚'; enableAnswerButtons(); } }
        function spawnEnemy() { if (enemies.length < maxEnemies) { const x = Math.random() * (canvas.width - 50); enemies.push(new Enemy(x, 0, 40, 40)); } }
        function handleCollisions() { enemies = enemies.filter(enemy => !enemy.isHit); enemies.forEach(enemy => { if (enemy.y + enemy.height > canvas.height) { endGame("æ•µè»çªç ´é˜²ç·šï¼Œä½ è¢«æ“Šæ•—äº†ï¼"); } }); }
        function update(deltaTime) { enemies.forEach(enemy => enemy.update()); bullets.forEach(bullet => bullet.update()); bullets = bullets.filter(bullet => !bullet.isDone); enemySpawnTimer += deltaTime; if (enemySpawnTimer > enemySpawnInterval) { spawnEnemy(); enemySpawnTimer = 0; } handleCollisions(); }
        function draw() { ctx.clearRect(0, 0, canvas.width, canvas.height); if (player) { player.draw(ctx); } enemies.forEach(enemy => enemy.draw(ctx)); bullets.forEach(bullet => bullet.draw(ctx)); }
        function gameLoop(currentTime) { if (!gameStarted || gameOver) return; const deltaTime = currentTime - lastFrameTime; lastFrameTime = currentTime; update(deltaTime); draw(); gameLoopId = requestAnimationFrame(gameLoop); }
        
        function startGame() {
            if (!isImageLoaded) { feedbackDisplay.textContent = 'åœ–ç‰‡ä»åœ¨è¼‰å…¥ä¸­...'; return; }
            gameStarted = true; gameOver = false; score = 0;
            
            enemySpeed = 0.5;
            enemySpawnInterval = initialEnemySpawnInterval;

            scoreDisplay.textContent = `åˆ†æ•¸: ${score}`;
            feedbackDisplay.textContent = '';
            enemies = []; bullets = []; askedQuestions.clear(); enemySpawnTimer = 0;
            player = new Player(canvas.width / 2 - 25, canvas.height - 60, 50, 50);
            generateQuestion();
            startGameButton.textContent = 'é‡æ–°é–‹å§‹';
            startGameButton.disabled = true;
            if (speedIncreaseIntervalId) clearInterval(speedIncreaseIntervalId);
            
            speedIncreaseIntervalId = setInterval(() => {
                enemySpeed *= 1.75;
                if (enemySpawnInterval > 800) {
                    enemySpawnInterval *= 0.8;
                }
                feedbackDisplay.textContent = 'é›£åº¦æå‡ï¼';
                setTimeout(() => { if (gameStarted && feedbackDisplay.textContent === 'é›£åº¦æå‡ï¼') { feedbackDisplay.textContent = ''; } }, 1500);
            }, 10000);

            lastFrameTime = performance.now();
            gameLoopId = requestAnimationFrame(gameLoop);
        }

        async function endGame(reason) {
            gameOver = true; gameStarted = false;
            feedbackDisplay.textContent = reason + ` æœ€çµ‚åˆ†æ•¸: ${score}`;
            if (gameLoopId) cancelAnimationFrame(gameLoopId);
            if (questionTimerIntervalId) clearInterval(questionTimerIntervalId);
            if (speedIncreaseIntervalId) clearInterval(speedIncreaseIntervalId);
            bullets = [];
            disableAnswerButtons();
            startGameButton.disabled = false;
            startGameButton.textContent = 'é‡æ–°é–‹å§‹';
            questionDisplay.textContent = 'éŠæˆ²çµæŸ';
            questionTimerBar.style.width = '0%';
            
            await saveToLeaderboard(currentPlayerName, score);
            setTimeout(displayLeaderboard, 1500);
        }

        function resizeCanvas() {
            const gameAreaElement = document.getElementById('game-area'); // ç²å– game-area å…ƒç´ 
            if (gameAreaElement) {
                canvas.width = gameAreaElement.clientWidth;
                // å°‡ canvas é«˜åº¦è¨­å®šç‚º gameAreaElement é«˜åº¦çš„ä¸€åŠï¼Œæˆ–è€…å›ºå®šçš„è¦–å£é«˜åº¦ä¸€åŠ
                canvas.height = window.innerHeight / 2;
            } else {
                canvas.width = window.innerWidth * 0.8;
                canvas.height = window.innerHeight / 2;
            }
            if (!gameStarted) {
                ctx.clearRect(0, 0, canvas.width, canvas.height);
                const tempPlayer = new Player(canvas.width / 2 - 25, canvas.height - 60, 50, 50);
                tempPlayer.draw(ctx);
            } else if (player) {
                player.x = canvas.width / 2 - player.width / 2;
                player.y = canvas.height - 60;
            }
            draw();
        }

        // äº‹ä»¶ç›£è½å™¨
        submitNameButton.addEventListener('click', () => {
            const name = playerNameInput.value.trim();
            if (name) {
                currentPlayerName = name;
                nameInputScreen.classList.add('hidden');
                nameInputScreen.classList.remove('flex');
                gameArea.classList.remove('hidden'); // ç¢ºä¿ gameArea é¡¯ç¤º
                gameArea.classList.add('flex'); // ç¢ºä¿ gameArea ä½¿ç”¨ flex ä½ˆå±€
                resizeCanvas();
            } else {
                alert('è«‹è¼¸å…¥ä¸€å€‹æœ‰æ•ˆçš„åç¨±ï¼');
            }
        });

        viewLeaderboardButton.addEventListener('click', displayLeaderboard);
        closeLeaderboardButton.addEventListener('click', () => {
            leaderboardScreen.classList.add('hidden');
            leaderboardScreen.classList.remove('flex');
        });
        
        homeButton.addEventListener('click', () => {
            // åœ¨ Canvas ç’°å¢ƒä¸­ï¼Œwindow.location.reload() æ˜¯è¿”å›ã€Œé¦–é ã€çš„æœ€ä½³æ–¹å¼
            window.location.reload();
        });
        
        startGameButton.addEventListener('click', startGame);
        window.addEventListener('resize', resizeCanvas);
        window.onload = () => { /* åˆå§‹ç•«é¢ç”±åç¨±è¼¸å…¥ç•«é¢æ§åˆ¶ */ };
    </script>
</body>
</html>
